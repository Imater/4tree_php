var my_autosave;var _0xf6db=["(6(){11 49=24;11 14={50:6(8,10){5 10.58(8)\x2692},57:6(8,10){7(8.58!=12){5 8.58(10)\x2616}46{5 8.57(10)}},55:6(8,18,10,20){7(8===10){5 18\x3C=20}7(14.29(8)\x26\x2614.29(10)){5 14.50(8,10)}7(14.29(8)\x26\x26!14.29(10)){5!14.55(10,20,8,18)}7(!14.57(8,10)){5 14.50(8,10)}7(8.47.85\x3C=18){5 40}7(8.47[18]===10){5 0\x3C=20}5 14.50(8.47[18],10)},29:6(61){5(61!=12?61.93==3:40)},81:6(41){11 62=0;88(41=41.59){62++}5 62}};11 4=49.4=(6(){6 4(2){24.2=2}4.34.31=6(){5 4.31(24.2)};4.34.37=6(){5 4.37(24.2)};4.34.38=6(){5 4.38(24.2)};4.34.45=6(){5 4.45(24.2)};4.34.44=6(){5 4.44(24.2)};4.34.52=6(25,26,23,22){5 4.52(24.2,25,26,23,22)};4.34.51=6(){5 4.51(24.2)};5 4})();7(49.35){4.67=43;4.31=6(2){11 9;5(9=2.35())\x26\x26(9.63!=12)\x26\x26(9.36!=12)};4.37=6(2){11 9;7(!((9=2.35())\x26\x26(9.36!=12))){5 12}5[9.36,9.97]};4.38=6(2){11 9;7(!((9=2.35())\x26\x26(9.63!=12))){5 12}5[9.63,9.91]};4.45=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[8,18]}5[10,20]};4.44=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[10,20]}5[8,18]};4.52=6(2,25,26,23,22){11 9=2.35();7(!9){5}7(23==12){23=25}7(22==12){22=26}7(9.60\x26\x269.79){9.60(25,26);9.79(23,22)}46{54=2.15.56();54.106(25,26);54.107(23,22);71{9.73()}80(41){}9.98(54)}};4.51=6(2){71{11 9=2.35();7(!9){5}9.73()}80(41){}}}46 7(49.15.39){11 69=6(42,32,30){11 19,13,21,33,64;13=42.90(\x2789\x27);19=32.103();19.60(30);64=19.77();88(43){64.86(13,13.59);19.82(13);7(!(19.87((30?\x2766\x27:\x2783\x27),32)\x3E0\x26\x26(13.59!=12))){99}}7(19.87((30?\x2766\x27:\x2783\x27),32)===-1\x26\x2613.84){19.74((30?\x27100\x27:\x2778\x27),32);21=13.84;33=19.101.85}46{21=13.48;33=14.81(13)}13.48.72(13);5[21,33]};11 68=6(42,32,30,21,33){11 36,65,19,13,53;53=0;36=14.29(21)?21:21.47[33];65=14.29(21)?21.48:21;7(14.29(21)){53=33}13=42.90(\x2789\x27);65.86(13,36||12);19=42.76.75();19.82(13);13.48.72(13);32.74((30?\x2766\x27:\x2778\x27),19);5 32[30?\x27105\x27:\x27104\x27](\x27102\x27,53)};4.67=43;4.31=6(2){11 17;2.70();7(!2.15.39){5 40}17=2.15.39.56();5 17\x26\x2617.77().15===2.15};4.45=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,43)};4.44=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,40)};4.37=6(2){5 4.45(2)};4.38=6(2){5 4.44(2)};4.52=6(2,25,26,23,22){7(23==12){23=25}7(22==12){22=26}11 17=2.15.76.75();68(2.15,17,40,23,22);68(2.15,17,43,25,26);5 17.96()};4.51=6(2){5 2.15.39.95()}}46{4.67=40}}).94(24);","|","split","||win||Selection|return|function|if|n1|sel|n2|var|null|cursorNode|Dom|document||range|o1|cursor|o2|node|foco|focn|this|orgn|orgo|_ref|_ref2|isText|bStart|hasSelection|textRange|offset|prototype|getSelection|anchorNode|getOrigin|getFocus|selection|false|e|doc|true|getEnd|getStart|else|childNodes|parentNode|root|isPreceding|clearSelection|setSelection|textOffset|r|isCursorPreceding|createRange|contains|compareDocumentPosition|previousSibling|collapse|d|k|focusNode|parent|anchorParent|StartToStart|supported|moveBoundary|getBoundary|focus|try|removeChild|removeAllRanges|setEndPoint|createTextRange|body|parentElement|EndToEnd|extend|catch|getChildIndex|moveToElementText|StartToEnd|nextSibling|length|insertBefore|compareEndPoints|while|a|createElement|focusOffset|0x02|nodeType|call|empty|select|anchorOffset|addRange|break|EndToStart|text|character|duplicate|moveEnd|moveStart|setStart|setEnd","replace","","\x5Cw+","\x5Cb","g"];eval(function(h,b,j,f,g,i){g=function(a){return a};if(!_0xf6db[5][_0xf6db[4]](/^/,String)){while(j--){i[j]=f[j]||j}f=[function(a){return i[a]}];g=function(){return _0xf6db[6]};j=1}while(j--){if(f[j]){h=h[_0xf6db[4]](new RegExp(_0xf6db[7]+g(j)+_0xf6db[7],_0xf6db[8]),f[j])}}return h}(_0xf6db[0],10,108,_0xf6db[3][_0xf6db[2]](_0xf6db[1]),0,{}));if(typeof RELANG==="undefined"){var RELANG={}}var RLANG={html:"HTML",video:"Insert Video...",image:"Insert Image...",table:"Table",link:"Link",link_insert:"Insert Link ...",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table...",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File...",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align Left",align_center:"Align Center",align_right:"Align Right",align_justify:"Justify",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab"};jQuery.fn.redactor=function(a){return this.each(function(){var c=$(this);var b=c.data("redactor");if(!b){c.data("redactor",(b=new Redactor(this,a)))}})};var Redactor=function(b,a){this.$el=$(b);if(typeof a!=="undefined"&&typeof a.lang!=="undefined"&&a.lang!=="en"&&typeof RELANG[a.lang]!=="undefined"){RLANG=RELANG[a.lang]}this.opts=$.extend({lang:"en",direction:"ltr",callback:false,keyupCallback:false,keydownCallback:false,execCommandCallback:false,focus:false,autoresize:true,fixed:false,source:true,mobile:true,air:false,wym:false,convertLinks:true,convertDivs:true,autosave:false,interval:60,imageGetJson:false,imageUpload:false,imageUploadCallback:false,fileUpload:false,fileUploadCallback:false,uploadCrossDomain:false,uploadFields:false,observeImages:true,overlay:true,allowedTags:["code","span","div","label","a","br","p","b","i","del","strike","img","video","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignleft","aligncenter","alignright","justify","|","horizontalrule"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],allEmptyHtml:"<p><br /></p>",mozillaEmptyHtml:"<p>&nbsp;</p>",buffer:false,visual:true,modal_file:String()+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form>',modal_image_edit:String()+"<label>"+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" style="color: #000;">'+RLANG._delete+'</a><span class="redactor_btns_box"><input type="button" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_image:String()+'<div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+RLANG.image_web_link+'</label><input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_link:String()+'<form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+RLANG.link_new_tab+'</div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'</label><input class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_table:String()+"<label>"+RLANG.rows+'</label><input size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'</label><input size="5" value="3" id="redactor_table_columns" /><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_video:String()+'<form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"justifyfull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},a,this.$el.data());this.dropdowns=[];this.init()};Redactor.prototype={init:function(){this.height=this.$el.css("height");this.width=this.$el.css("width");if(this.opts.mobile===false&&this.isMobile()){this.build(true);return false}if(this.opts.air){this.opts.buttons=this.opts.airButtons}else{if(this.opts.toolbar!==false){if(this.opts.source===false){var a=this.opts.buttons.indexOf("html");var b=this.opts.buttons[a+1];this.opts.buttons.splice(a,1);if(typeof b!=="undefined"&&b==="|"){this.opts.buttons.splice(a,1)}}$.extend(this.opts.toolbar,this.opts.buttonsCustom);$.each(this.opts.buttonsAdd,$.proxy(function(c,d){this.opts.buttons.push(d)},this))}}this.build();this.enableAir();this.buildToolbar();if(this.isMobile(true)===false){this.$editor.bind("paste",$.proxy(function(c){this.setBuffer();if(this.opts.autoresize===true){this.saveScroll=document.body.scrollTop}else{this.saveScroll=this.$editor.scrollTop()}var d=this.extractContent();setTimeout($.proxy(function(){var e=this.extractContent();this.$editor.append(d);this.restoreSelection();var f=this.getFragmentHtml(e);this.pasteCleanUp(f)},this),1)},this))}this.keyup();this.keydown();if(this.opts.autosave!==false){this.autoSave()}this.observeImages();this.observeTables();if($.browser.mozilla){document.execCommand("enableObjectResizing",false,false);document.execCommand("enableInlineTableEditing",false,false)}if(this.opts.focus){this.$editor.focus()}if(this.opts.fixed){this.observeScroll();$(document).scroll($.proxy(this.observeScroll,this))}if(typeof this.opts.callback==="function"){this.opts.callback(this)}},shortcuts:function(b,a){b.preventDefault();this.execCommand(a,false)},keyup:function(){this.$editor.keyup($.proxy(function(b){var a=b.keyCode||b.which;clearTimeout(my_autosave);note_saved=false;my_autosave=setTimeout(function(){savetext(1)},3000);if(typeof this.opts.keyupCallback==="function"){this.opts.keyupCallback(this,b)}if(a===8||a===46){this.observeImages();return this.formatEmpty(b)}if(a===13&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){return this.formatNewLine(b)}},this))},keydown:function(){var a=window.document.body;a.onpaste=function(j){var f=j.clipboardData.items;console.info(j.clipboardData.getData("text/html"));for(var g=0;g<f.length;++g){console.info(f[g].getAsFile());if(f[g].kind=="file"&&f[g].type.indexOf("image/")!==-1){j.stopPropagation();var d=f[g].getAsFile();window.URL=window.URL||window.webkitURL;var c=window.URL.createObjectURL(d);var b=document.createElement("img");b.src=c;var k=new XMLHttpRequest();k.open("POST","do.php?save_blob="+$("#redactor_content").attr("notes").replace("node_",""),true);k.responseType="text";k.onload=function(i){myr.insertHtml('<img title="Загружено из буфера обмена '+Date()+'" src='+k.response+">");clearTimeout(my_autosave);note_saved=false;savetext(1)};var h=new FormData();h.append("file",d);k.send(h);return false}}};this.$editor.keydown($.proxy(function(g){var b=g.keyCode||g.which;var c=this.getParentNode();var f=false;var d=g.ctrlKey||g.metaKey;if(c&&$(c).get(0).tagName==="PRE"){f=true}if(typeof this.opts.keydownCallback==="function"){this.opts.keydownCallback(this,g)}if(d){if(b===90){if(this.opts.buffer!==false){g.preventDefault();this.getBuffer()}else{this.shortcuts(g,"undo")}}else{if(b===90&&g.shiftKey){this.shortcuts(g,"redo")}else{if(b===77){this.shortcuts(g,"removeFormat")}else{if(b===66){this.shortcuts(g,"bold")}else{if(b===73){this.shortcuts(g,"italic")}else{if(b===74){this.shortcuts(g,"insertunorderedlist")}else{if(b===75){this.shortcuts(g,"insertorderedlist")}else{if(b===76){this.shortcuts(g,"superscript")}else{if(b===72){this.shortcuts(g,"subscript")}else{if(b===83){g.preventDefault();clearTimeout(my_autosave);note_saved=false;savetext(1)}}}}}}}}}}}if(!d&&b!==90){this.opts.buffer=false}if(f===true&&b===13){g.preventDefault();this.insertNodeAtCaret(document.createTextNode("\r\n"))}if(!g.shiftKey&&b===9){if(f===false){this.shortcuts(g,"indent")}else{g.preventDefault();this.insertNodeAtCaret(document.createTextNode("\t"))}}else{if(g.shiftKey&&b===9){this.shortcuts(g,"outdent")}}if($.browser.webkit&&navigator.userAgent.indexOf("Chrome")===-1){return this.safariShiftKeyEnter(g,b)}},this))},build:function(b){if(b!==true){this.$box=$('<div class="redactor_box"></div>');if(this.opts.air){this.air=$('<div class="redactor_air" style="display: none;"></div>')}this.textareamode=true;if(this.$el.get(0).tagName==="TEXTAREA"){this.$editor=$("<div></div>")}else{this.textareamode=false;this.$editor=this.$el;this.$el=$('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height)}this.$editor.addClass("redactor_editor").attr("contenteditable",true).attr("dir",this.opts.direction);if(this.opts.wym===true){this.$editor.addClass("redactor_editor_wym")}if(this.opts.autoresize===false){this.$editor.css("height",this.height)}this.$el.hide();var c="";if(this.textareamode){c=this.$el.val();this.$box.insertAfter(this.$el).append(this.$editor).append(this.$el)}else{c=this.$editor.html();this.$box.insertAfter(this.$editor).append(this.$el).append(this.$editor)}c=this.paragraphy(c);this.$editor.html(c);if(this.textareamode===false){this.syncCode()}}else{if(this.$el.get(0).tagName!=="TEXTAREA"){var c=this.$el.val();var a=$('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(c);this.$el.hide();this.$el.after(a)}}},enableAir:function(){if(this.opts.air===false){return false}this.air.hide();this.$editor.bind("textselect",$.proxy(function(a){this.showAir(a)},this));this.$editor.bind("textunselect",$.proxy(function(){this.air.hide()},this))},showAir:function(c){$(".redactor_air").hide();var a=this.air.innerWidth();var b=c.clientX;if($(document).width()<(b+a)){b=b-a}this.air.css({left:b+"px",top:(c.clientY+$(document).scrollTop()+14)+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html())},setCode:function(a){this.$editor.html(a);this.syncCode()},getCode:function(){if(this.opts.visual){return this.$editor.html()}else{return this.$el.val()}},insertHtml:function(a){this.execCommand("inserthtml",a);this.observeImages()},destroy:function(){var b=this.getCode();if(this.textareamode){this.$box.after(this.$el);this.$box.remove();this.$el.height(this.height).val(b).show()}else{this.$box.after(this.$editor);this.$box.remove();this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",false).html(b).show()}$(".redactor_air").remove();for(var a=0;a<this.dropdowns.length;a++){this.dropdowns[a].remove();delete (this.dropdowns[a])}},observeImages:function(){if(this.opts.observeImages===false){return false}this.$editor.find("img").each($.proxy(function(a,b){if($.browser.msie){$(b).attr("unselectable","on")}this.resizeImage(b)},this))},observeTables:function(){this.$editor.find("table").click($.proxy(this.tableObserver,this))},observeScroll:function(){var a=$(document).scrollTop();var b=this.$box.offset().top;if(a>b){this.fixed=true;this.$toolbar.css({position:"fixed",width:"100%",zIndex:100})}else{this.fixed=false;this.$toolbar.css({position:"relative",width:"auto",zIndex:1})}},setBuffer:function(){this.saveSelection();this.opts.buffer=this.$editor.html()},getBuffer:function(){if(this.opts.buffer===false){return false}this.$editor.html(this.opts.buffer);if(!$.browser.msie){this.restoreSelection()}this.opts.buffer=false},execCommand:function(d,g){clearTimeout(my_autosave);note_saved=false;my_autosave=setTimeout(function(){savetext(1)},1000);try{var b;if(d==="inserthtml"&&$.browser.msie){document.selection.createRange().pasteHTML(g)}else{if(d==="formatblock"&&$.browser.msie){document.execCommand(d,false,"<"+g+">")}else{if(d==="unlink"){b=this.getParentNode();if($(b).get(0).tagName==="A"){$(b).replaceWith($(b).text())}else{document.execCommand(d,false,g)}}else{if(d==="formatblock"&&g==="blockquote"){b=this.getParentNode();if($(b).get(0).tagName==="BLOCKQUOTE"){document.execCommand(d,false,"p")}else{if($(b).get(0).tagName==="P"){var a=$(b).parent();if($(a).get(0).tagName==="BLOCKQUOTE"){var c=$("<p>"+$(b).html()+"</p>");$(a).replaceWith(c);this.setFocusNode(c.get(0))}else{document.execCommand(d,false,g)}}else{document.execCommand(d,false,g)}}}else{if(d==="formatblock"&&g==="pre"){b=this.getParentNode();if($(b).get(0).tagName==="PRE"){$(b).replaceWith("<p>"+$(b).text()+"</p>")}else{document.execCommand(d,false,g)}}else{document.execCommand(d,false,g)}}}}}if(d==="inserthorizontalrule"){this.$editor.find("hr").removeAttr("id")}this.syncCode();if(this.oldIE()){this.$editor.focus()}if(typeof this.opts.execCommandCallback==="function"){this.opts.execCommandCallback(this,d)}if(this.opts.air){this.air.hide()}}catch(f){}},formatNewLine:function(c){if($.browser.webkit){var b=this.getParentNode();if(b.nodeName==="DIV"&&b.className==="redactor_editor"){c.preventDefault();var a=$(this.getCurrentNode());if(a.get(0).tagName==="DIV"&&(a.html()===""||a.html()==="<br>")){var d=$("<p>").append(a.clone().get(0).childNodes);a.replaceWith(d);d.html("<br />");this.setFocusNode(d.get(0));this.syncCode();return false}else{this.syncCode()}if(this.opts.convertLinks){this.$editor.linkify()}}else{this.syncCode();return true}}else{this.syncCode();return true}},safariShiftKeyEnter:function(c,b){if(c.shiftKey&&b===13){c.preventDefault();var a=$("<span><br /></span>");this.insertNodeAtCaret(a.get(0));this.syncCode();return false}else{return true}},formatEmpty:function(d){var b=$.trim(this.$editor.html());if($.browser.mozilla){b=b.replace(/<br>/i,"")}if(b===""){d.preventDefault();var a=this.opts.allEmptyHtml;if($.browser.mozilla){a=this.opts.mozillaEmptyHtml}var c=$(a).get(0);this.$editor.html(c);this.setFocusNode(c);this.syncCode();return false}else{this.syncCode()}},paragraphy:function(c){c=$.trim(c);if(c===""){if(!$.browser.mozilla){return this.opts.allEmptyHtml}else{return this.opts.mozillaEmptyHtml}}if(this.opts.convertDivs){c=c.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")}var d=function(f,g,e){return f.replace(new RegExp(g,"g"),e)};var a=function(f,e){return d(c,f,e)};var b="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";c+="\n";a("<br />\\s*<br />","\n\n");a("(<"+b+"[^>]*>)","\n$1");a("(</"+b+">)","$1\n\n");a("\r\n|\r","\n");a("\n\n+","\n\n");a("\n?((.|\n)+?)$","<p>$1</p>\n");a("<p>\\s*?</p>","");a("<p>(<div[^>]*>\\s*)","$1<p>");a("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2");a("<p>\\s*(</?"+b+"[^>]*>)\\s*</p>","$1");a("<p>(<li.+?)</p>","$1");a("<p>\\s*(</?"+b+"[^>]*>)","$1");a("(</?"+b+"[^>]*>)\\s*</p>","$1");a("(</?"+b+"[^>]*>)\\s*<br />","$1");a("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1");if(c.indexOf("<pre")!=-1){a("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(h,g,f,e){return d(g,"\\\\(['\"\\\\])","$1")+d(d(d(e,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"})}return a("\n</p>$","</p>")},stripTags:function(b){var c=this.opts.allowedTags;var a=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return b.replace(a,function(e,d){return $.inArray(d.toLowerCase(),c)>"-1"?e:""})},pasteCleanUp:function(a){a=a.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"");a=a.replace(/(&nbsp;){1,}/gi,"&nbsp;");a=a.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2");a=this.stripTags(a);a=a.replace(/<td><br><\/td>/gi,"[td]");a=a.replace(/<a(.*?)>([\w\W]*?)<\/a>/gi,"[a$1]$2[/a]");a=a.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]");a=a.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]");a=a.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]");a=a.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]");a=a.replace(/<img(.*?)>/gi,"[img$1]");a=a.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>");a=a.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"");a=a.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"");a=a.replace(/\[td\]/gi,"<td><br></td>");a=a.replace(/\[a(.*?)\]([\w\W]*?)\[\/a\]/gi,"<a$1>$2</a>");a=a.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>");a=a.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2[/video>");a=a.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2[/audio>");a=a.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>");a=a.replace(/\[img(.*?)\]/gi,"<img$1>");if(this.opts.convertDivs){a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")}a=a.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");a=a.replace(/\n{3,}/gi,"\n");a=a.replace(/<p><p>/g,"<p>");a=a.replace(/<\/p><\/p>/g,"</p>");this.execCommand("inserthtml",a);if(this.opts.autoresize===true){$(document.body).scrollTop(this.saveScroll)}else{this.$editor.scrollTop(this.saveScroll)}},formattingRemove:function(b){var a=[];var c=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);if(c!==null){$.each(c,function(d,e){b=b.replace(e,"prebuffer_"+d);a.push(e)})}b=b.replace(/\s{2,}/g," ");b=b.replace(/\n/g," ");b=b.replace(/[\t]*/g,"");b=b.replace(/\n\s*\n/g,"\n");b=b.replace(/^[\s\n]*/g,"");b=b.replace(/[\s\n]*$/g,"");b=b.replace(/>\s+</g,"><");if(a){$.each(a,function(d,e){b=b.replace("prebuffer_"+d,e)});a=[]}return b},formattingIndenting:function(a){a=a.replace(/<li/g,"\t<li");a=a.replace(/<tr/g,"\t<tr");a=a.replace(/<td/g,"\t\t<td");a=a.replace(/<\/tr>/g,"\t</tr>");return a},formattingEmptyTags:function(d){var c=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"];for(var b=0;b<c.length;++b){var a=c[b];d=d.replace(new RegExp(a,"gi"),"")}return d},formattingAddBefore:function(c){var d="\r\n";var e=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"];for(var b=0;b<e.length;++b){var a=e[b];c=c.replace(new RegExp(a,"gi"),d+a)}return c},formattingAddAfter:function(c){var e="\r\n";var a=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"];for(var b=0;b<a.length;++b){var d=a[b];c=c.replace(new RegExp(d,"gi"),d+e)}return c},formatting:function(a){a=this.formattingRemove(a);a=this.formattingEmptyTags(a);a=this.formattingAddBefore(a);a=this.formattingAddAfter(a);a=this.formattingIndenting(a);return a},toggle:function(){var a;if(this.opts.visual){this.$editor.hide();a=this.$editor.html();a=$.trim(this.formatting(a));this.$el.height(this.$editor.innerHeight()).val(a).show().focus();this.setBtnActive("html");this.opts.visual=false}else{this.$el.hide();this.$editor.html(this.$el.val());this.$editor.show();if(this.$editor.html()===""){if(!$.browser.mozilla){a=this.opts.allEmptyHtml}else{a=this.opts.mozillaEmptyHtml}this.setCode(a)}this.$editor.focus();this.setBtnInactive("html");this.opts.visual=true;this.observeImages();this.observeTables()}},autoSave:function(){setInterval($.proxy(function(){$.post(this.opts.autosave,{data:this.getCode()})},this),this.opts.interval*1000)},buildToolbar:function(){if(this.opts.toolbar===false){return false}this.$toolbar=$("<ul>").addClass("redactor_toolbar");if(this.opts.air){$(this.air).append(this.$toolbar);$("body").prepend(this.air)}else{this.$box.prepend(this.$toolbar)}$.each(this.opts.buttons,$.proxy(function(e,d){if(d!=="|"&&typeof this.opts.toolbar[d]!=="undefined"){var f=this.opts.toolbar[d];if(this.opts.fileUpload===false&&d==="file"){return true}var b=$("<li>");var c=this.buildButton(d,f);if(d==="backcolor"||d==="fontcolor"||typeof(f.dropdown)!=="undefined"){var g=$('<div class="redactor_dropdown" style="display: none;">');if(d==="backcolor"||d==="fontcolor"){g=this.buildColorPicker(g,d)}else{g=this.buildDropdown(g,f.dropdown)}this.dropdowns.push(g.appendTo($(document.body)));this.hdlHideDropDown=$.proxy(function(a){this.hideDropDown(a,g,d)},this);this.hdlShowDropDown=$.proxy(function(a){this.showDropDown(a,g,d)},this);c.click(this.hdlShowDropDown)}this.$toolbar.append($(b).append(c))}if(d==="|"){this.$toolbar.append($('<li class="redactor_separator"></li>'))}},this));$(document).click(this.hdlHideDropDown);this.$editor.click(this.hdlHideDropDown)},buildButton:function(b,c){var a=$('<a href="javascript:void(null);" title="'+c.title+'" class="redactor_btn_'+b+'"></a>');if(typeof c.func==="undefined"){a.click($.proxy(function(){this.execCommand(c.exec,b)},this))}else{if(c.func!=="show"){a.click($.proxy(function(d){this[c.func](d)},this))}}if(typeof c.callback!=="undefined"){a.click($.proxy(function(d){c.callback(this,d,b)},this))}return a},buildDropdown:function(b,a){$.each(a,$.proxy(function(c,f){if(typeof(f.className)==="undefined"){f.className=""}var e;if(typeof f.name!=="undefined"&&f.name==="separator"){e=$('<a class="redactor_separator_drop">')}else{e=$('<a href="javascript:void(null);" class="'+f.className+'">'+f.title+"</a>");if(typeof(f.func)==="undefined"){$(e).click($.proxy(function(){this.execCommand(f.exec,c)},this))}else{$(e).click($.proxy(function(d){this[f.func](d)},this))}}$(b).append(e)},this));return b},buildColorPicker:function(j,h){var d;if(h==="backcolor"){if($.browser.msie){d="BackColor"}else{d="hilitecolor"}}else{d="forecolor"}$(j).width(210);var e=this.opts.colors.length;for(var c=0;c<e;++c){var a=this.opts.colors[c];var g=$('<a rel="'+a+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:a});$(j).append(g);var f=this;$(g).click(function(){f.execCommand(d,$(this).attr("rel"));if(d==="forecolor"){f.$editor.find("font").replaceWith(function(){return $('<span style="color: '+$(this).attr("color")+';">'+$(this).html()+"</span>")})}if($.browser.msie&&d==="BackColor"){f.$editor.find("font").replaceWith(function(){return $('<span style="'+$(this).attr("style")+'">'+$(this).html()+"</span>")})}})}var b=$('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);if(h==="backcolor"){b.click($.proxy(this.setBackgroundNone,this))}else{b.click($.proxy(this.setColorNone,this))}$(j).append(b);return j},setBackgroundNone:function(){$(this.getParentNode()).css("background-color","transparent");this.syncCode()},setColorNone:function(){$(this.getParentNode()).attr("color","").css("color","");this.syncCode()},showDropDown:function(f,g,a){if(this.getBtn(a).hasClass("dropact")){this.hideAllDropDown()}else{this.hideAllDropDown();this.setBtnActive(a);this.getBtn(a).addClass("dropact");var d=this.getBtn(a).offset().left;if(this.opts.air){var b=this.air.offset().top;$(g).css({position:"absolute",left:d+"px",top:b+30+"px"}).show()}else{if(this.opts.fixed&&this.fixed){$(g).css({position:"fixed",left:d+"px",top:"30px"}).show()}else{var c=this.$toolbar.offset().top+30;$(g).css({position:"absolute",left:d+"px",top:c+"px"}).show()}}}},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact");$(".redactor_dropdown").hide()},hideDropDown:function(b,c,a){if(!$(b.target).hasClass("dropact")){$(c).removeClass("act");this.showedDropDown=false;this.hideAllDropDown()}},getSelection:function(){if(typeof window.getSelection!=="undefined"){return document.getSelection()}else{if(typeof document.selection!=="undefined"){return document.selection.createRange()}}},getFragmentHtml:function(b){var a=b.cloneNode(true);var c=document.createElement("div");c.appendChild(a);return c.innerHTML},extractContent:function(){var a=this.$editor.get(0);var c=document.createDocumentFragment(),b;while((b=a.firstChild)){c.appendChild(b)}return c},saveSelection:function(){this.savedSel=null;this.savedSelObj=null;if($.browser.msie&&parseInt($.browser.version,10)<9){var a=this.$editor.get(0);this.savedSel=window.Selection.getOrigin(a);this.savedSelObj=window.Selection.getFocus(a)}else{this.savedSel=window.Selection.getOrigin(window);this.savedSelObj=window.Selection.getFocus(window)}},restoreSelection:function(){if(this.savedSel!==null&&this.savedSelObj!==null&&this.savedSel[0].tagName!=="BODY"){window.Selection.setSelection(window,this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1])}else{this.$editor.focus()}},getParentNode:function(){if(typeof window.getSelection!=="undefined"){var a=window.getSelection();if(a.rangeCount>0){return this.getSelection().getRangeAt(0).startContainer.parentNode}else{return false}}else{if(typeof document.selection!=="undefined"){return this.getSelection().parentElement()}}},getCurrentNode:function(){if(typeof window.getSelection!=="undefined"){return this.getSelection().getRangeAt(0).startContainer}else{if(typeof document.selection!=="undefined"){return this.getSelection()}}},setFocusNode:function(c){if(typeof c==="undefined"){return false}try{var a=document.createRange();var b=this.getSelection();if(b!==null){a.selectNodeContents(c);b.addRange(a);b.collapse(c,0)}this.$editor.focus()}catch(d){}},insertNodeAtCaret:function(e){if(window.getSelection){var f=this.getSelection();if(f.rangeCount){var b=f.getRangeAt(0);b.collapse(false);b.insertNode(e);b=b.cloneRange();b.selectNodeContents(e);b.collapse(false);f.removeAllRanges();f.addRange(b)}}else{if(document.selection){var c=(e.nodeType===1)?e.outerHTML:e.data;var g="marker_"+(""+Math.random()).slice(2);c+='<span id="'+g+'"></span>';var d=this.getSelection();d.collapse(false);d.pasteHTML(c);var a=document.getElementById(g);d.moveToElementText(a);d.select();a.parentNode.removeChild(a)}}},getSelectedHtml:function(){var d="";if(window.getSelection){var e=window.getSelection();if(e.rangeCount){var b=document.createElement("div");for(var c=0,a=e.rangeCount;c<a;++c){b.appendChild(e.getRangeAt(c).cloneContents())}d=b.innerHTML}}else{if(document.selection){if(document.selection.type==="Text"){d=document.selection.createRange().htmlText}}}return d},getBtn:function(a){return $(this.$toolbar.find("a.redactor_btn_"+a))},setBtnActive:function(a){this.getBtn(a).addClass("act")},setBtnInactive:function(a){this.getBtn(a).removeClass("act")},resizeImage:function(e){var f=false;var b=false;var d;var a;var g=$(e).width()/$(e).height();var c=10;var h=10;$(e).hover(function(){$(e).css("cursor","nw-resize")},function(){$(e).css("cursor","default");f=false});$(e).mousedown(function(i){i.preventDefault();f=true;b=true;d=Math.round(i.pageX-$(e).eq(0).offset().left);a=Math.round(i.pageY-$(e).eq(0).offset().top)});$(e).mouseup($.proxy(function(i){f=false;this.syncCode()},this));$(e).click($.proxy(function(i){if(b){this.imageEdit(i)}},this));$(e).mousemove(function(m){if(f){b=false;var j=Math.round(m.pageX-$(this).eq(0).offset().left)-d;var i=Math.round(m.pageY-$(this).eq(0).offset().top)-a;var l=$(e).height();var n=parseInt(l,10)+i;var k=n*g;if(k>c){$(e).width(k)}if(n>h){$(e).height(n)}d=Math.round(m.pageX-$(this).eq(0).offset().left);a=Math.round(m.pageY-$(this).eq(0).offset().top)}})},showTable:function(){this.saveSelection();this.modalInit(RLANG.table,"table",300,$.proxy(function(){$("#redactor_insert_table_btn").click($.proxy(this.insertTable,this))},this),function(){$("#redactor_table_rows").focus()})},insertTable:function(){var k=$("#redactor_table_rows").val();var d=$("#redactor_table_columns").val();var a=$("<div></div>");var b=Math.floor(Math.random()*99999);var h=$('<table id="table'+b+'"><tbody></tbody></table>');for(var e=0;e<k;e++){var j=$("<tr></tr>");for(var g=0;g<d;g++){var c=$("<td><br></td>");$(j).append(c)}$(h).append(j)}$(a).append(h);var f=$(a).html()+"<p></p>";this.restoreSelection();this.execCommand("inserthtml",f);this.modalClose();this.observeTables()},tableObserver:function(a){this.$table=$(a.target).parents("table");this.$table_tr=this.$table.find("tr");this.$table_td=this.$table.find("td");this.$table_td.removeClass("current");this.$tbody=$(a.target).parents("tbody");this.$thead=$(this.$table).find("thead");this.$current_td=$(a.target);this.$current_td.addClass("current");this.$current_tr=$(a.target).parents("tr")},deleteTable:function(){$(this.$table).remove();this.$table=false;this.syncCode()},deleteRow:function(){$(this.$current_tr).remove();this.syncCode()},deleteColumn:function(){var a=$(this.$current_td).get(0).cellIndex;$(this.$table).find("tr").each(function(){$(this).find("td").eq(a).remove()});this.syncCode()},addHead:function(){if($(this.$table).find("thead").size()!==0){this.deleteHead()}else{var a=$(this.$table).find("tr").first().clone();a.find("td").html("&nbsp;");this.$thead=$("<thead></thead>");this.$thead.append(a);$(this.$table).prepend(this.$thead);this.syncCode()}},deleteHead:function(){$(this.$thead).remove();this.$thead=false;this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(a){var b=$(this.$current_tr).clone();b.find("td").html("&nbsp;");if(a==="after"){$(this.$current_tr).after(b)}else{$(this.$current_tr).before(b)}this.syncCode()},insertColumn:function(b){var a=0;this.$current_td.addClass("current");this.$current_tr.find("td").each(function(c,d){if($(d).hasClass("current")){a=c}});this.$table_tr.each(function(c,d){var e=$(d).find("td").eq(a);var f=e.clone();f.html("&nbsp;");if(b==="after"){$(e).after(f)}else{$(e).before(f)}});this.syncCode()},showVideo:function(){this.saveSelection();this.modalInit(RLANG.video,"video",600,$.proxy(function(){$("#redactor_insert_video_btn").click($.proxy(this.insertVideo,this))},this),function(){$("#redactor_insert_video_area").focus()})},insertVideo:function(){var a=$("#redactor_insert_video_area").val();a=this.stripTags(a);this.restoreSelection();this.execCommand("inserthtml",a);this.modalClose()},imageEdit:function(d){var a=$(d.target);var c=a.parent();var b=$.proxy(function(){$("#redactor_file_alt").val(a.attr("alt"));$("#redactor_image_edit_src").attr("href",a.attr("src"));$("#redactor_form_image_align").val(a.css("float"));if($(c).get(0).tagName==="A"){$("#redactor_file_link").val($(c).attr("href"))}$("#redactor_image_delete_btn").click($.proxy(function(){this.imageDelete(a)},this));$("#redactorSaveBtn").click($.proxy(function(){this.imageSave(a)},this))},this);this.modalInit(RLANG.image,"image_edit",380,b)},imageDelete:function(a){$(a).remove();this.modalClose();this.syncCode()},imageSave:function(b){var a=$(b).parent();$(b).attr("alt",$("#redactor_file_alt").val());var d=$("#redactor_form_image_align").val();if(d==="left"){$(b).css({"float":"left",margin:"0 10px 10px 0"})}else{if(d==="right"){$(b).css({"float":"right",margin:"0 0 10px 10px"})}else{$(b).css({"float":"none",margin:"0"})}}var c=$.trim($("#redactor_file_link").val());if(c!==""){if($(a).get(0).tagName!=="A"){$(b).replaceWith('<a href="'+c+'">'+this.outerHTML(b)+"</a>")}else{$(a).attr("href",c)}}else{if($(a).get(0).tagName==="A"){$(a).replaceWith(this.outerHTML(b))}}this.modalClose();this.observeImages();this.syncCode()},showImage:function(){this.saveSelection();var a=$.proxy(function(){if(this.opts.imageGetJson!==false){$.getJSON(this.opts.imageGetJson,$.proxy(function(g){var e={};var i=0;$.each(g,$.proxy(function(j,k){if(typeof k.folder!=="undefined"){i++;e[k.folder]=i}},this));var f=false;$.each(g,$.proxy(function(m,n){var l="";if(typeof n.title!=="undefined"){l=n.title}var j=0;if(!$.isEmptyObject(e)&&typeof n.folder!=="undefined"){j=e[n.folder];if(f===false){f=".redactorfolder"+j}}var k=$('<img src="'+n.thumb+'" class="redactorfolder redactorfolder'+j+'" rel="'+n.image+'" title="'+l+'" />');$("#redactor_image_box").append(k);$(k).click($.proxy(this.imageSetThumb,this))},this));if(!$.isEmptyObject(e)){$(".redactorfolder").hide();$(f).show();var h=function(j){$(".redactorfolder").hide();$(".redactorfolder"+$(j.target).val()).show()};var d=$('<select id="redactor_image_box_select">');$.each(e,function(l,j){d.append($('<option value="'+j+'">'+l+"</option>"))});$("#redactor_image_box").before(d);d.change(h)}},this))}else{$("#redactor_tabs a").eq(1).remove()}if(this.opts.imageUpload!==false){if(this.opts.uploadCrossDomain===false&&this.isMobile()===false){if($("#redactor_file").size()!==0){$("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:$.proxy(this.imageUploadCallback,this)})}}this.uploadInit("redactor_file",{auto:true,url:this.opts.imageUpload,success:$.proxy(this.imageUploadCallback,this)})}else{$(".redactor_tab").hide();if(this.opts.imageGetJson===false){$("#redactor_tabs").remove();$("#redactor_tab3").show()}else{var c=$("#redactor_tabs a");c.eq(0).remove();c.eq(1).addClass("redactor_tabs_act");$("#redactor_tab2").show()}}$("#redactor_upload_btn").click($.proxy(this.imageUploadCallbackLink,this))},this);var b=$.proxy(function(){if(this.opts.imageUpload===false&&this.opts.imageGetJson===false){$("#redactor_file_link").focus()}},this);this.modalInit(RLANG.image,"image",570,a,b,true)},imageSetThumb:function(a){this._imageSet('<img src="'+$(a.target).attr("rel")+'" alt="'+$(a.target).attr("title")+'" />',true)},imageUploadCallbackLink:function(){if($("#redactor_file_link").val()!==""){var a='<img src="'+$("#redactor_file_link").val()+'" />';this._imageSet(a,true)}else{this.modalClose()}},imageUploadCallback:function(a){this._imageSet(a)},_imageSet:function(b,c){this.restoreSelection();if(b!==false){var a="",d="";if(c!==true){d=$.parseJSON(b);a='<p><img src="'+d.filelink+'" /></p>'}else{a=b}this.execCommand("inserthtml",a);if(c!==true&&typeof this.opts.imageUploadCallback==="function"){this.opts.imageUploadCallback(this,d)}}this.modalClose();this.observeImages()},showLink:function(){this.saveSelection();var a=$.proxy(function(){this.insert_link_node=false;var f=this.getSelection();var c="",h="",g="";if($.browser.msie){var d=this.getParentNode();if(d.nodeName==="A"){this.insert_link_node=$(d);h=this.insert_link_node.text();c=this.insert_link_node.attr("href");g=this.insert_link_node.attr("target")}else{if(this.oldIE()){h=f.text}else{h=f.toString()}}}else{if(f&&f.anchorNode&&f.anchorNode.parentNode.tagName==="A"){c=f.anchorNode.parentNode.href;h=f.anchorNode.parentNode.text;g=f.anchorNode.parentNode.target;if(f.toString()===""){this.insert_link_node=f.anchorNode.parentNode}}else{h=f.toString()}}$(".redactor_link_text").val(h);var e=c.replace(self.location.href,"");if(c.search("mailto:")===0){this.setModalTab(2);$("#redactor_tab_selected").val(2);$("#redactor_link_mailto").val(c.replace("mailto:",""))}else{if(e.search(/^#/gi)===0){this.setModalTab(3);$("#redactor_tab_selected").val(3);$("#redactor_link_anchor").val(e.replace(/^#/gi,""))}else{$("#redactor_link_url").val(c)}}if(g==="_blank"){$("#redactor_link_blank").attr("checked",true)}$("#redactor_insert_link_btn").click($.proxy(this.insertLink,this))},this);var b=function(c){$("#redactor_link_url").focus()};this.modalInit(RLANG.link,"link",460,a,b)},insertLink:function(){var b=$("#redactor_tab_selected").val();var a="",d="",c="";if(b==="1"){a=$("#redactor_link_url").val();d=$("#redactor_link_url_text").val();if($("#redactor_link_blank").attr("checked")){c="_blank"}}else{if(b==="2"){a="mailto:"+$("#redactor_link_mailto").val();d=$("#redactor_link_mailto_text").val()}else{if(b==="3"){a="#"+$("#redactor_link_anchor").val();d=$("#redactor_link_anchor_text").val()}}}this._insertLink('<a href="'+a+'" target="'+c+'">'+d+"</a>&nbsp;",$.trim(d),a,c)},_insertLink:function(b,e,c,d){this.$editor.focus();this.restoreSelection();if(e!==""){if(this.insert_link_node){$(this.insert_link_node).text(e);$(this.insert_link_node).attr("href",c);if(d!==""){$(this.insert_link_node).attr("target",d)}this.syncCode()}else{this.execCommand("inserthtml",b)}}this.modalClose()},showFile:function(){this.saveSelection();var a=$.proxy(function(){var b=this.getSelection();var c="";if(this.oldIE()){c=b.text}else{c=b.toString()}$("#redactor_filename").val(c);if(this.opts.uploadCrossDomain===false&&this.isMobile()===false){$("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:$.proxy(function(d){this.fileUploadCallback(d)},this)})}this.uploadInit("redactor_file",{auto:true,url:this.opts.fileUpload,success:$.proxy(function(d){this.fileUploadCallback(d)},this)})},this);this.modalInit(RLANG.file,"file",500,a)},fileUploadCallback:function(a){this.restoreSelection();if(a!==false){var c=$.parseJSON(a);var d=$("#redactor_filename").val();if(d===""){d=c.filename}var b='<a href="'+c.filelink+'">'+d+"</a>";if($.browser.webkit&&!!window.chrome){b=b+"&nbsp;"}this.execCommand("inserthtml",b);if(typeof this.opts.fileUploadCallback==="function"){this.opts.fileUploadCallback(this,c)}}this.modalClose()},modalInit:function(g,b,d,c,f){if($("#redactor_modal_overlay").size()===0){this.overlay=$('<div id="redactor_modal_overlay" style="display: none;"></div>');$("body").prepend(this.overlay)}if(this.opts.overlay){$("#redactor_modal_overlay").show();$("#redactor_modal_overlay").click($.proxy(this.modalClose,this))}if($("#redactor_modal").size()===0){this.modal=$('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>');$("body").append(this.modal)}$("#redactor_modal_close").click($.proxy(this.modalClose,this));this.hdlModalClose=$.proxy(function(h){if(h.keyCode===27){this.modalClose()}},this);$(document).keyup(this.hdlModalClose);this.$editor.keyup(this.hdlModalClose);$("#redactor_modal_inner").html(this.opts["modal_"+b]);$("#redactor_modal_header").html(g);if($("#redactor_tabs").size()!==0){var e=this;$("#redactor_tabs a").each(function(h,j){h++;$(j).click(function(){$("#redactor_tabs a").removeClass("redactor_tabs_act");$(this).addClass("redactor_tabs_act");$(".redactor_tab").hide();$("#redactor_tab"+h).show();$("#redactor_tab_selected").val(h);if(e.isMobile()===false){var i=$("#redactor_modal").outerHeight();$("#redactor_modal").css("margin-top","-"+(i+10)/2+"px")}})})}$("#redactor_btn_modal_close").click($.proxy(this.modalClose,this));if(typeof(c)==="function"){c()}var a=$("#redactor_modal").outerHeight();if(this.isMobile()===false){$("#redactor_modal").css({position:"fixed",top:"50%",left:"50%",width:d+"px",height:"auto",minHeight:"auto",marginTop:"-"+(a+10)/2+"px",marginLeft:"-"+(d+60)/2+"px"}).fadeIn("fast");this.modalSaveBodyOveflow=$(document.body).css("overflow");$(document.body).css("overflow","hidden")}else{$("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show()}if(typeof(f)==="function"){f()}},modalClose:function(){$("#redactor_modal_close").unbind("click",this.modalClose);$("#redactor_modal").fadeOut("fast",$.proxy(function(){$("#redactor_modal_inner").html("");if(this.opts.overlay){$("#redactor_modal_overlay").hide();$("#redactor_modal_overlay").unbind("click",this.modalClose)}$(document).unbind("keyup",this.hdlModalClose);this.$editor.unbind("keyup",this.hdlModalClose)},this));if(this.isMobile()===false){$(document.body).css("overflow",this.modalSaveBodyOveflow)}},setModalTab:function(a){$(".redactor_tab").hide();var b=$("#redactor_tabs a");b.removeClass("redactor_tabs_act");b.eq(a-1).addClass("redactor_tabs_act");$("#redactor_tab"+a).show()},uploadInit:function(b,a){this.uploadOptions={url:false,success:false,start:false,trigger:false,auto:false,input:false};$.extend(this.uploadOptions,a);if($("#"+b).size()!==0&&$("#"+b).get(0).tagName==="INPUT"){this.uploadOptions.input=$("#"+b);this.element=$($("#"+b).get(0).form)}else{this.element=$("#"+b)}this.element_action=this.element.attr("action");if(this.uploadOptions.auto){$(this.uploadOptions.input).change($.proxy(function(){this.element.submit(function(c){return false});this.uploadSubmit()},this))}else{if(this.uploadOptions.trigger){$("#"+this.uploadOptions.trigger).click($.proxy(this.uploadSubmit,this))}}},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(Math.random()*99999);var b=document.createElement("div");var a='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';b.innerHTML=a;document.body.appendChild(b);if(this.uploadOptions.start){this.uploadOptions.start()}$("#"+this.id).load($.proxy(this.uploadLoaded,this));return this.id},uploadForm:function(d,c){if(this.uploadOptions.input){var e="redactorUploadForm"+this.id;var a="redactorUploadFile"+this.id;this.form=$('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+c+'" name="'+e+'" id="'+e+'" enctype="multipart/form-data"></form>');if(this.opts.uploadFields!==false&&typeof this.opts.uploadFields==="object"){$.each(this.opts.uploadFields,$.proxy(function(h,f){if(f.indexOf("#")===0){f=$(f).val()}var i=$('<input type="hidden" name="'+h+'" value="'+f+'">');$(this.form).append(i)},this))}var b=this.uploadOptions.input;var g=$(b).clone();$(b).attr("id",a);$(b).before(g);$(b).appendTo(this.form);$(this.form).css("position","absolute");$(this.form).css("top","-2000px");$(this.form).css("left","-2000px");$(this.form).appendTo("body");this.form.submit()}else{d.attr("target",c);d.attr("method","POST");d.attr("enctype","multipart/form-data");d.attr("action",this.uploadOptions.url);this.element.submit()}},uploadLoaded:function(){var c=$("#"+this.id);var e;if(c.contentDocument){e=c.contentDocument}else{if(c.contentWindow){e=c.contentWindow.document}else{e=window.frames[this.id].document}}if(this.uploadOptions.success){if(typeof e!=="undefined"){var b=e.body.innerHTML;var a=b.match(/\{.*\}/)[0];this.uploadOptions.success(a)}else{alert("Upload failed!");this.uploadOptions.success(false)}}this.element.attr("action",this.element_action);this.element.attr("target","")},oldIE:function(){if($.browser.msie&&parseInt($.browser.version,10)<9){return true}return false},outerHTML:function(a){return $("<p>").append($(a).eq(0).clone()).html()},normalize:function(a){return parseInt(a.replace("px",""),10)},isMobile:function(a){if(a===true&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)){return true}else{if(/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)){return true}else{return false}}}};$.fn.getEditor=function(){return this.data("redactor").$editor};$.fn.getCode=function(){return this.data("redactor").getCode()};$.fn.getText=function(){return this.data("redactor").$editor.text()};$.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()};$.fn.setCode=function(a){this.data("redactor").setCode(a)};$.fn.insertHtml=function(a){this.data("redactor").insertHtml(a)};$.fn.destroyEditor=function(){this.data("redactor").destroy();this.removeData("redactor")};$.fn.setFocus=function(){this.data("redactor").focus()};$.fn.execCommand=function(a,b){this.data("redactor").execCommand(a,b)};(function(b){b.fn.dragupload=function(c){return this.each(function(){var d=new a(this,c);d.init()})};function a(d,c){this.opts=b.extend({url:false,success:false,preview:false,uploadFields:false,text:RLANG.drop_file_here,atext:RLANG.or_choose},c);this.$el=b(d)}a.prototype={init:function(){if(!b.browser.msie){this.droparea=b('<div class="redactor_droparea"></div>');this.dropareabox=b('<div class="redactor_dropareabox">'+this.opts.text+"</div>");this.dropalternative=b('<div class="redactor_dropalternative">'+this.opts.atext+"</div>");this.droparea.append(this.dropareabox);this.$el.before(this.droparea);this.$el.before(this.dropalternative);this.dropareabox.bind("dragover",b.proxy(function(){return this.ondrag()},this));this.dropareabox.bind("dragleave",b.proxy(function(){return this.ondragleave()},this));var e=b.proxy(function(g){var f=parseInt(g.loaded/g.total*100,10);this.dropareabox.text("Loading "+f+"%")},this);var d=jQuery.ajaxSettings.xhr();if(d.upload){d.upload.addEventListener("progress",e,false)}var c=function(){return d};this.dropareabox.get(0).ondrop=b.proxy(function(h){h.preventDefault();this.dropareabox.removeClass("hover").addClass("drop");var g=h.dataTransfer.files[0];var f=new FormData();if(this.opts.uploadFields!==false&&typeof this.opts.uploadFields==="object"){b.each(this.opts.uploadFields,b.proxy(function(j,i){if(i.indexOf("#")===0){i=b(i).val()}f.append(j,i)},this))}f.append("file",g);b.ajax({dataType:"html",url:this.opts.url,data:f,xhr:c,cache:false,contentType:false,processData:false,type:"POST",success:b.proxy(function(i){if(this.opts.success!==false){this.opts.success(i)}if(this.opts.preview===true){this.dropareabox.html(i)}},this)})},this)}},ondrag:function(){this.dropareabox.addClass("hover");return false},ondragleave:function(){this.dropareabox.removeClass("hover");return false}}})(jQuery);(function(b){var d=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,a=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,c=function(){var g=this.childNodes,f=g.length;while(f--){var h=g[f];if(h.nodeType===3){var e=h.nodeValue;if(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(d,'$1<a href="http://$2">$2</a>$3').replace(a,'$1<a href="$2">$2</a>$5');b(h).after(e).remove()}}else{if(h.nodeType===1&&!/^(a|button|textarea)$/i.test(h.tagName)){c.call(h)}}}};b.fn.linkify=function(){this.each(c)}})(jQuery);(function(a){a.event.special.textselect={setup:function(c,b){a(this).data("textselected",false);a(this).data("ttt",c);a(this).bind("mouseup",a.event.special.textselect.handler)},teardown:function(b){a(this).unbind("mouseup",a.event.special.textselect.handler)},handler:function(b){var c=a(this).data("ttt");var d=a.event.special.textselect.getSelectedText(c).toString();if(d!=""){a(this).data("textselected",true);b.type="textselect";b.text=d;a.event.handle.apply(this,arguments)}},getSelectedText:function(b){var c="";if(window.getSelection){c=window.getSelection()}else{if(document.getSelection){c=document.getSelection()}else{if(document.selection){c=document.selection.createRange().text}}}return c}};a.event.special.textunselect={setup:function(c,b){a(this).data("rttt",c);a(this).data("textselected",false);a(this).bind("mouseup",a.event.special.textunselect.handler);a(this).bind("keyup",a.event.special.textunselect.handlerKey)},teardown:function(b){a(this).unbind("mouseup",a.event.special.textunselect.handler)},handler:function(b){if(a(this).data("textselected")){var c=a(this).data("rttt");var d=a.event.special.textselect.getSelectedText(c).toString();if(d==""){a(this).data("textselected",false);b.type="textunselect";a.event.handle.apply(this,arguments)}}},handlerKey:function(b){if(a(this).data("textselected")){var c=a(this).data("rttt");var d=a.event.special.textselect.getSelectedText(c).toString();if((b.keyCode=27)&&(d=="")){a(this).data("textselected",false);b.type="textunselect";a.event.handle.apply(this,arguments)}}}}})(jQuery);