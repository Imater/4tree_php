var tip,hoverout;var myr=null,mynode,hover_tm,i_am_scroll=1;var timeout,mt,mt2,timenow=0,mytree,tttt,sel_tm;var calend;var bg;var i_am_busy=true;var note_saved=true,show_checked=false;var savecookies,myscroll=-1;var mycookie=new Number;var save_cookie=true;mycookie.current_tab=1;function PrintIt(b){var a=navigator.userAgent;var c=/MSIE/.test(a);wnd=window.open("","tinyWindow","statusbar=no,toolbar=no,scrollbars=yes,resizable=yes,width=630,height=900");wnd.document.write('<html><title>4tree — мои дела</title><head><link href="css/print.css"rel="stylesheet"type="text/css" media="all"/><link rel="stylesheet" href="css/styles.css" type="text/css"></style><link rel="stylesheet" href="./redactor/redactor/redactor.css" /><link rel=\'stylesheet\' type=\'text/css\' href=\'./fullcalendar-1.5.3/fullcalendar/fullcalendar.css\' /></head><body onclick="window.close()"><div id="watermark-top"></div>');wnd.document.write(b);if(!c){wnd.document.write('<div id="watermark-bottom">4tree.ru</div><body></html>');wnd.print()}else{wnd.document.write("<script>window.onload=self.print();<\/script></body></html>");wnd.location.reload()}}function jscookie(c,b,a){if(!b){return mycookie[c]}else{if(save_cookie){mycookie[c]=b;clearTimeout(savecookies);savecookies=setTimeout(function(){console.info("Сохранил кукис");var e=$.ajax({type:"POST",url:"do.php",data:mycookie,success:function(f){}})},5000)}}}jQuery.fn.swapWith=function(a){return this.each(function(){var b=$(a).clone(true);var c=$(this).clone(true);$(a).replaceWith(c);$(this).replaceWith(b)})};function jsFocus(a){$("#demo").jstree("deselect_all");save_cookie=false;parent=$(".second_ul").children("li").attr("id");$("#"+parent).swapWith("#li_temp");if(a!=1){$(".main_ul").hide();$(".second_ul").show();$.ajaxSetup({async:false});if(!$("#demo li[id=node_"+a+"]").length){path=$("#tabs li a[myid="+a+"]").attr("path");path=path.split(",");for(i=0;i<path.length;i=i+1){toopen=path[i];$("#demo").jstree("open_node",$("#node_"+toopen),false)}}setTimeout(function(){$(".second_ul ul").height("auto")},300);$("#node_"+a).swapWith("#li_temp");$("#demo").jstree("close_all",$("#node_"+a),false);$("#demo").jstree("show_cookie")}else{$(".main_ul").show();$(".second_ul").hide();$("#demo").jstree("close_all",[],false);setTimeout(function(){console.info(new_cookie_name);$("#demo").jstree("show_cookie")},200)}$.ajaxSetup({async:false});myscroll=jscookie(a+"_scroll");setTimeout(function(){$("#demo").stop().scrollTop(myscroll);myscroll=-1},155);setTimeout(function(){save_cookie=true},100)}function jsFocus3(a){save_cookie=false;new_cookie_name=a;myscroll=jscookie(a+"_scroll");setTimeout(function(){$("#demo").stop().scrollTop(myscroll);myscroll=-1},155);parent=$(".second_ul").children("li").attr("id");if(parent){$("#"+parent).swapWith("#li_temp")}if(a=="1"){$(".main_ul").show()}else{$.ajaxSetup({async:false});if(!$("#demo li[id=node_"+a+"]").length){path=$("#tabs li a[myid="+a+"]").attr("path");path=path.split(",");for(i=0;i<path.length;i=i+1){toopen=path[i];$("#demo").jstree("open_node",$("#node_"+toopen),false)}}console.info($("#li_temp").swapWith("#node_"+a));$(".second_ul").show()}$.ajaxSetup({async:false});$.ajaxSetup({async:true});$("#demo").jstree("show_cookie");setTimeout(function(){save_cookie=true},1000);$.ajaxSetup({async:true})}function jsFocus1(b){var a=true;new_cookie_name=b;myscroll=jscookie(b+"_scroll");setTimeout(function(){$("#demo").stop().scrollTop(myscroll);myscroll=-1},55);$.ajaxSetup({async:false});if(b=="1"){console.info("открыл 1ю вкладку");$("#demo li").hide();$("#demo .temp-last-class").removeClass("jstree-last");$("#demo li[class!=closed]").show();$("#demo .tip").hide()}else{if(!$("#demo li[id=node_"+b+"]").length){path=$("#tabs li a[myid="+b+"]").attr("path");path=path.split(",");for(i=0;i<path.length;i=i+1){toopen=path[i];$("#demo").jstree("open_node",$("#node_"+toopen),false)}}$("#demo li").hide();$("#demo .temp-last-class").removeClass("jstree-last");myli=$("#demo li[id=node_"+b+"]").show();$("#demo .tip").hide();if(!myli.hasClass("jstree-last")){myli.addClass("jstree-last").addClass("temp-last-class")}myli.parents("li").show().each(function(){if(!$(this).hasClass("jstree-last")){$(this).addClass("jstree-last").addClass("temp-last-class")}});$("#demo").jstree("open_all",$("#node_"+b));$("#demo li[id=node_"+b+"] li[class!=closed]").show();$("#demo .tip").hide()}$("#demo").jstree("close_all");$("#demo").jstree("show_cookie");$.ajaxSetup({async:true});setTimeout(function(){var c=false},1000)}function jsLoadNote(c){savetext(1);var b="";$.ajaxSetup({async:false});var a=0;if($(".jstree-clicked").length>1){a=1}$(".jstree-clicked").each(function(){c=$(this).parent("li").attr("id");$("#bubu").load("do.php?notes="+c,function(){var e="";nodes=$("#demo").jstree("get_path",$("#"+c),true);for(i=0;i<nodes.length;i=i+1){e=e+$("#demo").jstree("get_text",$("#"+nodes[i]));if(i<nodes.length-1){e=e+" → "}if(i==nodes.length-2){e=e+"<br><h2>"}}if(a==1){mytext='<div class="divider" contenteditable="false" id="'+c+'">'+e+'</h2></div><div class="edit_text"><p>'}else{mytext=""}if($("#bubu").html()==""){$("#bubu").html("&nbsp;")}b=b+mytext+$("#bubu").html()+"</p></div>"})});$("#redactor_content").attr("notes",c);$("#redactor_content").setCode(b);$.ajaxSetup({async:true});lnk="do.php?load="+c;$.getJSON(lnk,function(e){if((e.info.date1=="0000-00-00 00:00:00")||!e.info.date1){$("#altdo_date1").val("");$("#do_date1").datetimeEntry("setDatetime",null)}else{$("#do_date1").datetimeEntry("setDatetime",sqlDate(e.info.date1))}if((e.info.date1=="0000-00-00 00:00:00")||!e.info.date2){$("#altdo_date2").val("");$("#do_date2").datetimeEntry("setDatetime",null)}else{$("#do_date2").datetimeEntry("setDatetime",sqlDate(e.info.date2))}})}function jsMakeTabWidth(){w=parseInt($("#cont").width());count=parseInt($("#cont2 a").length);w2=parseInt($("#cont2 li").width());w_tab=parseInt(w/(count)-38);if(w_tab<30){if(w_tab<20){w_tab=parseInt(w/(count)-12);var b=parseInt(w_tab/4);$("#tabs a .ff").each(function(){$(this).html($(this).parents("a").attr("title").substr(0,b))});$("#tabs").css("font-size","7px");$("#tabs a").css("padding","4px 4px")}else{var b=parseInt(w_tab/3);$("#tabs a .ff").each(function(){$(this).html($(this).parents("a").attr("title").substr(0,b))});$("#tabs a").css("padding","4px 15px");$("#tabs").css("font-size","8px")}$("#cont2 img").hide()}else{w_tab=parseInt(w/(count)-47);var b=parseInt(w_tab/7);$("#tabs a .ff").each(function(){$(this).html($(this).parents("a").attr("title").substr(0,b))});$("#cont2 img").show();$("#tabs").css("font-size","10px");$("#tabs a").css("padding","4px 15px")}if(w_tab>90){w_tab=90}$("#cont2 a").css("width",w_tab);$("#cont2").show();return true;$("#tabs").hide();var a=10;$("#tabs").css("font-size",a+"px");while($("#tabs").height()>20){if(a<=7){$("#tabs a img").hide()}else{$("#tabs a img").show()}$("#tabs").css("font-size",a+"px");a=a-1}}function onResize(){clearTimeout(mt2);mt2=setTimeout(function(){jsMakeTabWidth();$("#top").css("bottom",$("#bottom").height());if($.cookie("swap_calendar")!=1){var a=$("#left_bottom2").height()-$(".redactor_toolbar").height()-32;var b=$("#left_bottom2").height()}else{var a=$("#top").height()-$(".redactor_toolbar").height()-32;var b=$("#top").height()}if(!$(".redactor_box").hasClass("redactor_box_fullscreen")){$(".redactor_editor").height(a);$(".redactor_box").height(b)}tree_height=parseFloat($("#left_top").height());toolbar_height=parseFloat($(".tree_toolbar").height());$("#demo").height(tree_height-toolbar_height);if($.cookie("swap_calendar")!=1){calheight=parseFloat($("#top").height())}else{calheight=parseFloat($("#left_bottom2").height())}newheight=calheight-35;$("#calendar").fullCalendar("option","contentHeight",newheight);$("#calendar").fullCalendar("rerenderEvents");jsSetTimeNow()},500)}function jsRefreshDate(a){if(a){a="[id=node_"+a+"]"}else{a=""}$("#demo li"+a).each(function(){$(this).children(".r").remove();$(this).children(".bell,.bell-no").remove();id=$(this).attr("id");date_tmp=$(this).attr("date1");if(date_tmp){date1=jsMakeDate(date_tmp,$(this).attr("remind"));$(date1).prependTo($(this))}})}function jsSetTimeNow(){cur_view=calend.fullCalendar("getView").name;if((cur_view=="agendaWeek")||(cur_view=="agendaDay")){$("* #time_now_to").each(function(){if($(this).children(".fc-mynow").html()==null){$('<div class="fc-mynow"></div>').prependTo(this)}if(cur_view=="agendaWeek"){if($(".fc-today").height()){myl=$(".fc-today").offset().left}else{myl=0;$(".fc-mynow").remove()}if($.cookie("swap_calendar")==1){swap=-1}else{swap=$("#left_top").width()+2}myleft=myl-$(".fc-agenda-axis").width()-3-swap-23;if($("#top").hasClass("fullscreen")){myleft=myl-2}if($("#left_bottom2").hasClass("fullscreen")){myleft=myl-swap-3}mywidth=$(".fc-today").width()}if(cur_view=="agendaDay"){myleft=$(".fc-agenda-axis").width()+10;mywidth="100%"}$(this).children(".fc-mynow").css("top",0).css("width",mywidth).css("left",myleft);currentTime=new Date;tim=currentTime.getHours()+currentTime.getMinutes()/60;timenow=$(this).height()/24*(tim);$(this).children(".fc-mynow").css({top:timenow})})}}function jsRefreshTabs(){current_tab=$("#cont2 li[id=current] a").attr("myid");if(!current_tab){current_tab=jscookie("current_tab")}$("#cont2").hide();$("#cont2").load("do.php?mytabs="+current_tab,function(){onResize();$("* #tabs").sortable({axis:"x"});$(".side_panel").sortable({axis:"y"});$("#side_folder .ff").draggable()})}function jsDoFirst(){jsTitle("Добро пожаловать");$("*").delegate("#to_home","click",function(g){document.location="./4tree.php";return false});$("*").delegate("#print_tree","click",function(g){PrintIt($("#demo").html());return false});$("*").delegate("#print_redactor","click",function(g){PrintIt(myr.getCode());return false});$("*").delegate("#print_calendar","click",function(g){$("#slot_scroll").height(1200);$("#fc-view").height(1200);PrintIt(calend.parent("div").html());return false});$("*").delegate("#full_screen_right","click",function(g){if(!$("#top").hasClass("fullscreen")){$(".icon-resize-full-1").attr("class","icon-resize-small");$("#top").addClass("fullscreen");onResize()}else{$(".icon-resize-small").attr("class","icon-resize-full-1");$("#top").removeClass("fullscreen");onResize()}return false});$("*").delegate("#full_screen_left","click",function(g){if(!$("#left").hasClass("fullscreen")){$(".icon-resize-full-1").attr("class","icon-resize-small");$("#left").addClass("fullscreen");onResize()}else{$(".icon-resize-small").attr("class","icon-resize-full-1");$("#left").removeClass("fullscreen");onResize()}return false});$("*").delegate("#full_screen_left2","click",function(g){if(!$("#left_bottom2").hasClass("fullscreen")){$(".icon-resize-full-1").attr("class","icon-resize-small");$("#left_bottom2").addClass("fullscreen");onResize()}else{$(".icon-resize-small").attr("class","icon-resize-full-1");$("#left_bottom2").removeClass("fullscreen");onResize()}return false});$(".side_panel_hover").hoverIntent(b,c);$("*").delegate(".side_panel","click",function(g){if($("#side_folder").css("display")=="none"){$("#side_arrow").hide();$("#side_folder").fadeIn(300)}else{$("#side_arrow").hide();$("#side_folder").fadeOut(500)}return false});$("*").delegate(".side_panel img","click",function(g){mytop=$(this).offset().top-11;oldmytop=$("#side_arrow").css("top");$("#side_arrow").css("top",mytop);if(($("#side_folder").css("display")=="none")||(mytop!=oldmytop)){$("#side_arrow").show();$("#side_folder").fadeIn(300)}else{$("#side_arrow").hide();$("#side_folder").fadeOut(500)}return false});$(".side_panel img").hoverIntent(function(){if($("#side_folder").css("display")=="none"){$(this).next(".name").fadeIn(100)}},function(){$(this).next(".name").fadeOut(500)},1);function b(){if((!$("#top").hasClass("fullscreen"))&&(!$("#left").hasClass("fullscreen"))&&(!$("#left_bottom2").hasClass("fullscreen"))){$("#left_panel").stop().animate({left:"0"},500);$("#right_panel").stop().animate({right:"0"},500)}}$("*").delegate(".side_panel","mouseleave",function(g){a();return false});function a(){if($("#side_folder").css("display")=="none"){$("#left_panel").stop().animate({left:"-74"},700);$("#right_panel").stop().animate({right:"-74"},700)}}function c(){}$("*").delegate("#demo .jstree-leaf a","hover",function(g){if($("#left_bottom").height()!=1){tip=$(this).find(".tip:last");tip.show()}return false});$("*").delegate("#demo .jstree-leaf a","mouseout",function(g){tip=$("* .tip");tip.hide();return false});$("*").delegate("#demo .jstree-leaf a","mousemove",function(p){if($("#left_bottom").height()!=1){tip=$(this).find(".tip:last");var k=p.pageX+20;var j=p.pageY+20;var g=tip.width();var o=tip.height();var n=$(window).width()-(k+g);var l=$(window).height()-(j+o);if(n<20){k=p.pageX-g-20}if(l<20){j=p.pageY-o-20}tip.css({top:j,left:k})}});if($.cookie("swap_calendar")==1){my_calendar=$("#calendar");my_redactor=$("#redactor_content");my_redactor.appendTo("#top");my_calendar.appendTo("#left_bottom2");$("#left_bottom_label").html("календарь")}$("*").undelegate("#demo","click").delegate("#demo","click",function(g){$("#demo").focus();return false});$("*").undelegate("#swap_calendar","click").delegate("#swap_calendar","click",function(g){if($.cookie("swap_calendar")==1){$.cookie("swap_calendar",0)}else{$.cookie("swap_calendar",1)}document.location.href="";return false});$("*").undelegate(".bell-no","click").delegate(".bell-no","click",function(g){id=$(this).parent("li").attr("id").replace("node_","");$("#bubu").load("do.php?set_reminder="+id,function(){$("#demo").jstree("refresh",-1)});return false});$("*").undelegate(".bell","click").delegate(".bell","click",function(g){id=$(this).parent("li").attr("id").replace("node_","");$("#bubu").load("do.php?delete_reminder="+id,function(){$("#demo").jstree("refresh",-1)});return false});setInterval(function(){jsRefreshDate()},5*60*1000);$("#search").hide();if($.cookie("hide_do")==1){$(".hide_checked").hide();show_checked="false"}else{$(".show_checked").hide();show_checked="true"}$(".search-ico").click(function(){$("#search").slideToggle("fast");$(".search-ico").toggleClass("active");if($(".search-ico").hasClass("active")){$("#textfilter").focus()}else{$("* #demo li a").removeClass("jstree-search")}});$("*").undelegate(".hide_checked","click").delegate(".hide_checked","click",function(g){$.cookie("hide_do",1);$(".hide_checked").hide();$(".show_checked").show();show_checked="false";$("#demo .jstree-checked").fadeOut(300).remove();return false});$("*").undelegate(".show_checked","click").delegate(".show_checked","click",function(g){$.cookie("hide_do",0);$(".show_checked").hide();$(".hide_checked").show();show_checked="true";$("#demo").jstree("refresh",-1);return false});$("*").undelegate("#textfilter","keyup").delegate("#textfilter","keyup",function(g){clearTimeout(tttt);$("* #demo li a").removeClass("jstree-search");tttt=setTimeout(function(){$("#demo").jstree("search",$("#textfilter").val())},500);if(g.keyCode=="13"){clearTimeout(tttt);$("* #demo li a").removeClass("jstree-search");tttt=setTimeout(function(){$("#demo").jstree("search",$("#textfilter").val())},10)}if(g.keyCode=="27"){$("#textfilter").val("");$("#search").slideUp("fast");$(".search-ico").removeClass("active");clearTimeout(tttt)}return false});$("*").delegate("#cont2 a","mouseout",function(g){$("* #cont2 a").css("color","");clearTimeout(hover_tm);return false});$("*").delegate("#cont2 a","mouseover",function(j){var g=$(this).attr("myid");old_id=$("* #cont2 li[id=current] a").attr("myid");$("* #cont2 a").css("color","");clearTimeout(hover_tm);if(false){if($("#node_"+g).attr("id")){if((g!=old_id)){hover_tm=setTimeout(function(){$("#demo").jstree("deselect_node");$("#demo").jstree("select_node",$("#node_"+g));$("* #cont2 a").css("color","")},1000)}}}$(this).css("color","red");return false});$("*").undelegate("#cont2 a","click").delegate("#cont2 a","click",function(j){j.preventDefault();old_name=$("#cont2 li[id=current] a").attr("title");old_cookie_name=$("#cont2 li[id=current] a").attr("myid");n_id=$(this).attr("myid");var g=$(this).attr("title");if((n_id!=old_cookie_name)||(true)){jscookie(old_cookie_name+"_scroll",$("#demo").scrollTop());new_cookie_name=n_id;jscookie("current_tab",n_id);$("#tabs li").attr("id","");$(this).parent().attr("id","current");jsFocus(n_id)}return false});lnk="do.php?getcookie";$.getJSON(lnk,function(g){if(g){mycookie=g}jsRefreshTabs();showTree(1,"tab1")});$(".tree_toolbar a").click(function(g){g.preventDefault();switch($(this).attr("class")){case"collapse":$("#demo").jstree("close_all");old_name=$("#cont2 li[id=current] a").attr("title");$.cookie(old_name+"select","");$.cookie(old_name+"tab1open","");$.cookie(old_name+"tab1scroll","");break;case"expand":$("#demo").jstree("open_all");break;case"add_default":$("#demo").jstree("create");break;case"remove":if(confirm("Вы действительно хотите удалить дело?")){$("#demo").jstree("remove")}break;case"rename":$("#demo").jstree("rename");break;case"refresh":jsRefreshTabs();$("#calendar").fullCalendar("refetchEvents");$("#demo").jstree("refresh",-1);break}});$(function(){$("#mmenu input").click(function(){switch(this.id){case"add_default":case"add_folder":$("#demo").jstree("create",null,"last",{attr:{rel:this.id.toString().replace("add_","")}});break;case"search":$("#demo").jstree("search",document.getElementById("text").value);break;case"text":break;case"Expand":$("#demo").jstree("open_all");break;case"Collapse":$("#demo").jstree("close_all");break;default:$("#demo").jstree(this.id);break}})});$.datetimeEntry.setDefaults({spinnerImage:"./img/spinnerDefault.png"});function e(g){if(0<=g&&g<10){return"0"+g.toString()}if(-10<g&&g<0){return"-0"+(-1*g).toString()}return g.toString()}Date.prototype.toMysqlFormat=function(){return this.getFullYear()+"-"+e(1+this.getMonth())+"-"+e(this.getDate())+" "+e(this.getHours())+":"+e(this.getMinutes())+":"+e(this.getSeconds())};function f(g){return{minDatetime:(g.id=="do_date2"?$("#date1").datetimeEntry("getDatetime"):null),maxDatetime:(g.id=="do_date1"?$("#do_date2").datetimeEntry("getDatetime"):null)}}$(".datetime").each(function(){x="#"+$(this).attr("id");$(x).datetimeEntry({beforeShow:f,datetimeFormat:"W N Y / H:M",altField:"#alt"+$(this).attr("id"),altFormat:"Y-O-D H:M:S"})});setInterval(function(){if($("#left_bottom").height()!=2){jsSetTimeNow()}},30000);currentTime=new Date;firstHour=currentTime.getHours()-2;calend=$("#calendar").fullCalendar({editable:"true",firstHour:firstHour,timeFormat:"H:mm",axisFormat:"H:mm",contentHeight:361,weekends:true,defaultView:"agendaWeek",droppable:true,drop:function(l,g,j,k){$.ajaxSetup({async:false});k.data.obj.each(function(){mynode=this.id;mydate=encodeURIComponent(l.toMysqlFormat());lnk="do.php?date_to_do="+$(this).attr("id")+"&date1="+mydate+"&allday="+g;$("#bubu").load(lnk,function(){new_date=$("#bubu").html();$("#"+mynode).attr("date1",new_date);jsRefreshDate(mynode.replace("node_",""));$("#calendar").fullCalendar("refetchEvents")})});$.ajaxSetup({async:true})},header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay,basicWeek,basicDay"},firstDay:1,eventSources:[{editable:"true"},{url:"do.php?calendar",className:"my_event"}],eventMouseover:function(g){if(false){hover_tm=setTimeout(function(){$("#demo").jstree("search","#node_"+g.id)},10000)}},eventMouseout:function(g){clearTimeout(hover_tm);if(!$(".search-ico").hasClass("active")){$("* #demo li a").removeClass("jstree-search")}},eventClick:function(g){i_am_scroll=0;my_id=$("#tabs li[id=current] a").attr("id");if(my_id!=1){ul=".second_ul"}else{ul=".main_ul"}if(!$(ul+" #node_"+g.id).length){if(my_id!=1){$("#tabs a[myid=1]").click()}path=g.path;path=path.split(",");$.ajaxSetup({async:false});for(i=0;i<path.length;i=i+1){toopen=path[i];$("#demo").jstree("open_node",$("#node_"+toopen),false)}$.ajaxSetup({async:true})}setTimeout(function(){$("#demo").jstree("deselect_all");$("#demo").jstree("select_node",$("#node_"+g.id))},1000)},eventDrop:function(k,l,j,g){if(g){lnk="do.php?movedo="+k.id+"&days="+l+"&minutes="+j+"&allday=1"}else{lnk="do.php?movedo="+k.id+"&days="+l+"&minutes="+j+"&allday=0"}$("#bubu").load(lnk,function(){var n=k.id;new_date=$("#bubu").html();$("#node_"+n).attr("date1",new_date);jsRefreshDate(n);$("* #demo").jstree("deselect_all");$("* #demo").jstree("select_node",$("#node_"+n))})},loading:function(g){if(g){$("#loading").show()}else{$("#loading").hide();jsSetTimeNow();$("#time_now_to").scrollTop(400)}},selectable:true,selectHelper:true,select:function(l,g,j){if(g-l==900000){calend.fullCalendar("unselect");return true}var k=prompt("Название события:");if(k){manager=encodeURIComponent($("#selectmanager").html());if(j==false){st=l.toString();en=g.toString()}else{st=l.toDateString();en=g.toDateString()}lnk="do.php?createdo="+encodeURIComponent(k)+"&start="+encodeURIComponent(st)+"&end="+encodeURIComponent(en)+"&allday="+j+"&manager="+manager;console.log(lnk);$("#bubu").load(lnk,function(){$("#calendar").fullCalendar("refetchEvents");$("#demo").jstree("refresh",-1);jsRefreshTabs()})}calend.fullCalendar("unselect")}});if(false){setTimeout(function(){$("#left_bottom_label").click();$("#fc-button-agendaWeek").click();$("#tabsminitop").click()},2000)}myr=$("#redactor_content").redactor({imageUpload:"./redactor/demo/scripts/image_upload.php",lang:"ru",focus:false,fileUpload:"./redactor/demo/scripts/file_upload.php",autoresize:false});$("#tabsminitop").click(function(){if($("#tabsminibottom").css("display")=="none"){$("#tabsminibottom").show();onResize()}else{$("#tabsminibottom").hide();onResize()}});if($("#left_bottom").height()==2){newh=$.cookie("height");if(newh!=""){note_height=parseFloat(newh)}if((note_height<3)||(!note_height)){note_height=300}$("#left_top").animate({bottom:note_height},300);$("#left_bottom").animate({height:note_height},300);onResize()}else{$("#left_top").animate({bottom:"2"},100);$("#left_bottom").animate({height:"2"},100);onResize()}$("#left_bottom_label").click(function(){if($("#left_bottom").height()==2){newh=$.cookie("height");if(newh!=""){note_height=parseFloat(newh)}if((note_height<3)||(!note_height)){note_height=300}$("#left_top").animate({bottom:note_height},300);$("#left_bottom").animate({height:note_height},300);onResize()}else{$("#left_top").animate({bottom:"2"},100);$("#left_bottom").animate({height:"2"},100);onResize()}});neww=$.cookie("width");if(neww!=""){neww=parseFloat(neww);$("#right").css("width",neww);$("#page").css("width",neww-3);$("#left").css("margin-right",neww)}$("#resize").mousedown(function(g){g.preventDefault();$("#left").addClass("noselectable");$("#resize").width("100%");$("#resize").css("z-index",10000);$("#resize").css("opacity","0.3");$(window).mousemove(function(j){w=$(document).width();neww=w-j.pageX-50;$("#right").css("width",neww);$("#page").css("width",neww-5);$("#left").css("margin-right",neww);onResize();$(window).resize()})});$(window).mouseup(function(){$(window).unbind("mousemove");$("#resize").width("5px").css("z-index",1).css("opacity","1");$.cookie("width",$("#right").width(),{expires:300});$("#left").removeClass("noselectable")});newh=$.cookie("height");if(newh!=""){newh=parseFloat(newh);if(newh<3){newh=300}$("#left_bottom").css("height",newh);$("#left_top").css("bottom",newh)}$("#left_bottom_label").mousedown(function(g){g.preventDefault();$(window).mousemove(function(j){h=$(document).height();newh=h-j.pageY-50;$("#left_bottom").css("height",newh);$("#left_top").css("bottom",newh);onResize();$(window).resize()})});$(window).mouseup(function(){$(window).unbind("mousemove");if($("#left_bottom").height()>2){$.cookie("height",$("#left_bottom").height(),{expires:300})}})}Date.createFromMysql=function(a){if(typeof a==="string"){var b=a.split(/[- :]/);return new Date(b[0],b[1]-1,b[2],b[3]||0,b[4]||0,b[5]||0)}return null};Date.prototype.yyyymmdd=function(){var c=this.getFullYear().toString();var b=(this.getMonth()+1).toString();var a=this.getDate().toString();return c+"-"+(b[1]?b:"0"+b[0])+"-"+(a[1]?a:"0"+a[0])};function jsMakeDate(b,f){var a="";var e="shortdate";var a="",c;today=new Date;dd=Math.round((Date.createFromMysql(b).getTime()-today.getTime())/60/60/1000*10)/10;if(b=="0000-00-00 00:00:00"){return""}if(dd>0){e="shortdate"}else{e="shortdatepast"}c=dd;if((dd>24)||(dd<-24)||(b.search("00:00:00")!=-1)){dd=Math.round(dd/24);a="long";if(dd>=0){mydays="+ "+dd+" дн"}else{mydays=dd+" дн"}}else{if(dd>=0){mydays="+ "+dd+" ч"}else{mydays=dd+" ч"}}if(b.search("00:00:00")!=-1){if(b.search(today.yyyymmdd())!=-1){mydays="сегодня";e="shortdatepast";a=""}}if(false){$class="shortdatedid";$long=""}if((f=="0000-00-00 00:00:00")||!f){bell_class="bell-no";title="Нажмите, чтобы включить SMS уведомление за 1 минуту"}else{bell_class="bell";title="Вы получите SMS уведомление за 1 минуту"}return"<i class='icon-bell-1 "+bell_class+"'></i><span class='r "+e+a+"' title='"+b+"'>"+mydays+"</span>"}function jsSetCheckBox(){i_am_busy=true;$('#demo li[did!="0000-00-00 00:00:00"]').each(function(){if($(this).attr("did")!=undefined){$("#demo").jstree("check_node",$(this))}});i_am_busy=false}function showTree(a,b){$("#demo").jstree("destroy");setTimeout(function(){if(b.replace("tab","node_")!="node_1"){$("#demo").children("ul").children("li[id!="+b.replace("tab","node_")+"]").remove()}},1000);mytree=$("#demo").bind("before.jstree",function(f,c){$("#alog").append(c.func+"<br />")}).jstree({plugins:["themes","json_data","ui","crrm","cookies","dnd","search","types","hotkeys","checkbox","contextmenu"],themes:{theme:"classic"},cookies:{save_opened:b+"open",save_selected:b+"select",auto_save:true},json_data:{ajax:{url:"./server.php",data:function(c){return{operation:"get_children",show_checked:show_checked,id:c.attr?c.attr("id").replace("node_",""):a}}}},search:{ajax:{url:"./server.php",data:function(c){return{operation:"search",search_str:c}}}},types:{max_depth:-2,max_children:-2,valid_children:["drive"],types:{"default":{valid_children:["default","folder"],icon:{image:"jstree/_demo/file.png"}},folder:{valid_children:["default","folder"],icon:{image:"./jstree/_demo/folder.png"}},drive:{valid_children:["default","folder"],icon:{image:"./jstree/_demo/root.png"},start_drag:false,move_node:false,delete_node:false,remove:false}}},core:{initially_open:false,animation:150,load_open:true,open_parents:false},checkbox:{two_state:true}}).bind("create.jstree",function(f,c){$.post("./server.php",{operation:"create_node",id:c.rslt.parent.attr("id").replace("node_",""),position:c.rslt.position,title:c.rslt.name,type:c.rslt.obj.attr("rel")},function(e){jsRefreshTabs();if(e.status){$(c.rslt.obj).attr("id","node_"+e.id)}else{$.jstree.rollback(c.rlbk)}})}).bind("remove.jstree",function(f,c){c.rslt.obj.each(function(){$.ajax({async:false,type:"POST",url:"./server.php",data:{operation:"remove_node",id:this.id.replace("node_","")},success:function(e){jsRefreshTabs();$("* #calendar").fullCalendar("refetchEvents");if(!e.status){c.inst.refresh()}}})})}).bind("rename.jstree",function(f,c){$.post("./server.php",{operation:"rename_node",id:c.rslt.obj.attr("id").replace("node_",""),title:c.rslt.new_name},function(e){jsRefreshTabs();$("* #calendar").fullCalendar("refetchEvents");if(!e.status){$.jstree.rollback(c.rlbk)}})}).bind("check_node.jstree",function(c,e){if(i_am_busy){return}id=e.rslt.obj.attr("id");lnk="do.php?check_it="+id;$.getJSON(lnk,function(f){jsTitle("Дело выполнено");$("* #calendar").fullCalendar("refetchEvents");jsRefreshTabs()})}).bind("uncheck_node.jstree",function(c,e){id=e.rslt.obj.attr("id");lnk="do.php?uncheck_it="+id;$.getJSON(lnk,function(f){jsTitle("Выполнение снято");$("* #calendar").fullCalendar("refetchEvents");jsRefreshTabs()})}).bind("select_node.jstree",function(c,e){clearTimeout(sel_tm);sel_tm=setTimeout(function(){id=e.rslt.obj.attr("id");current_tab=$("#cont2 li[id=current] a").attr("myid");jscookie(current_tab+"_scroll",$("#demo").scrollTop());gotodate=e.rslt.obj.attr("date1");$.ajaxSetup({async:false});var f=0;if((gotodate!="0000-00-00 00:00:00")&&(gotodate)){gotodate=sqlDate(gotodate);d=gotodate.getDate();m=gotodate.getMonth();y=gotodate.getFullYear();h=gotodate.getHours();f=parseInt((95/24)*h)-6;$("#calendar").fullCalendar("gotoDate",y,m,d)}$("* .fc-event-vert,.fc-event-hori").removeClass("event-selected");$(".fc-event-title[event="+id+"]").parents(".fc-event-vert,.fc-event-hori").addClass("event-selected");jsLoadNote(id);if((f!=0)&&(i_am_scroll==1)){$("* #slot_scroll").each(function(){f=$(this).find(".fc-slot"+f);if(f.offset()){sc2=f.offset().top;sc3=$(this).offset().top;sc4=$(this).scrollTop();var g=sc4-(sc3-sc2);$(this).stop().animate({scrollTop:g},800)}})}else{i_am_scroll=1}$.ajaxSetup({async:true})},300)}).bind("after_open.jstree",function(f,c){clearTimeout(timeout);timeout=setTimeout(function(){$(".r,.gray").remove();jsRefreshDate();jsSetCheckBox();if($.cookie("hide_do")==1){$("#demo .jstree-checked").remove()}if(b.replace("tab","node_")!="node_1"){$("#demo").children("ul").children("li[id!="+b.replace("tab","node_")+"]").remove()}},50)}).bind("loaded.jstree",function(f,c){setTimeout(function(){$("#tabs a[myid="+jscookie("current_tab")+"]").click()},500)}).bind("move_node.jstree",function(f,c){c.rslt.o.each(function(e){$.ajax({async:false,type:"POST",url:"./server.php",data:{operation:"move_node",id:$(this).attr("id").replace("node_",""),ref:c.rslt.cr===-1?1:c.rslt.np.attr("id").replace("node_",""),position:c.rslt.cp+e,title:c.rslt.name,copy:c.rslt.cy?1:0},success:function(g){if(!g.status){$.jstree.rollback(c.rlbk)}else{$(c.rslt.oc).attr("id","node_"+g.id);if(c.rslt.cy&&$(c.rslt.oc).children("UL").length){c.inst.refresh(c.inst._get_parent(c.rslt.oc))}}$("#analyze").click()}})})})}function sqlDate(b){if(!b){return null}var a=b.split(/[- :]/);var c=new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5]);if(b=="0000-00-00 00:00:00"){c=null}return(c)}function savetext(c){if(note_saved==true){return false}clearTimeout(my_autosave);if($(".divider").attr("id")){$(".divider").each(function(){b=$(this).next(".edit_text").html();text=b;var e=$(this).attr("id");jsSendText(e,text,c)});return false}var b=myr.getCode();text=b;var a=$("#redactor_content").attr("notes");jsSendText(a,text,c)}function jsSendText(b,e,c){if($("#"+b).find(".tip").attr("class")){$("#"+b).find(".tip").html(e.substr(0,1000))}else{$('<div class="tip">'+e.substr(0,1000)+"</div>").appendTo($("#"+b).children("a"))}e=encodeURIComponent(e);dataString="savenote="+b+"&text="+e+"&date1="+$("#altdo_date1").val()+"&date2="+$("#altdo_date2").val();var a=$.ajax({type:"POST",url:"do.php",data:dataString,success:function(f){note_saved=true;if(f=="del"){mynode=$("* #demo li[id="+$("#redactor_content").attr("notes")+"] > a");if(mynode.parent("li").hasClass("jstree-leaf")){mynode.children(".jstree-icon").css("background","")}}else{if(f!=""){mynode=$("* #demo li[id="+$("#redactor_content").attr("notes")+"] > a");if(mynode.parent("li").hasClass("jstree-leaf")){mynode.children(".jstree-icon").css("background","url("+f+") 50% 50% no-repeat")}}}if(c!=1){$("#demo").jstree("refresh",-1);$("#calendar").fullCalendar("refetchEvents")}onResize();if(b){jsTitle("текст заметки №"+b.replace("node_","")+" сохранён")}}})}function jsTitle(a){setTimeout(function(){if($(".title").html()!=("<b>"+a+"</b>")){$(".title").css("opacity","0").html("<b>"+a+"</b>").animate({opacity:"0.7"},1000,function(){setTimeout(function(){$(".title").animate({opacity:"0"},300,function(){$(".title").html("")})},2000)})}},200)}(function(a){a.fn.hoverIntent=function(o,n){var p={sensitivity:7,interval:700,timeout:0};p=a.extend(p,n?{over:o,out:n}:o);var r,q,k,e;var j=function(f){r=f.pageX;q=f.pageY};var c=function(g,f){f.hoverIntent_t=clearTimeout(f.hoverIntent_t);if((Math.abs(k-r)+Math.abs(e-q))<p.sensitivity){a(f).unbind("mousemove",j);f.hoverIntent_s=1;return p.over.apply(f,[g])}else{k=r;e=q;f.hoverIntent_t=setTimeout(function(){c(g,f)},p.interval)}};var l=function(g,f){f.hoverIntent_t=clearTimeout(f.hoverIntent_t);f.hoverIntent_s=0;return p.out.apply(f,[g])};var b=function(s){var g=jQuery.extend({},s);var f=this;if(f.hoverIntent_t){f.hoverIntent_t=clearTimeout(f.hoverIntent_t)}if(s.type=="mouseenter"){k=g.pageX;e=g.pageY;a(f).bind("mousemove",j);if(f.hoverIntent_s!=1){f.hoverIntent_t=setTimeout(function(){c(g,f)},p.interval)}}else{a(f).unbind("mousemove",j);if(f.hoverIntent_s==1){f.hoverIntent_t=setTimeout(function(){l(g,f)},p.timeout)}}};return this.bind("mouseenter",b).bind("mouseleave",b)}})(jQuery);